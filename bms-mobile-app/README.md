# ğŸ”‹ BMS æ‰‹æ©Ÿç›£æ§æ‡‰ç”¨ç¨‹å¼

> å°ˆæ¥­ç´šé›»æ± ç®¡ç†ç³»çµ± (Battery Management System) æ‰‹æ©Ÿç›£æ§æ‡‰ç”¨ç¨‹å¼  
> æ”¯æ´ DALY BMS D2 Modbus å”è­°ï¼Œå®Œå…¨é›¢ç·šé‹è¡Œï¼Œç„¡é›²ç«¯ä¾è³´

åŸºæ–¼ React Native + TypeScript é–‹ç™¼çš„å°ˆæ¥­ç´š BMS ç›£æ§æ‡‰ç”¨ç¨‹å¼ï¼Œå°ˆç‚ºç›£æ§ LiFePO4 é›»æ± çµ„è€Œè¨­è¨ˆã€‚æ‡‰ç”¨ç¨‹å¼æ¡ç”¨å®Œå…¨é›¢ç·šæ¶æ§‹ï¼Œç›´æ¥é€éè—ç‰™é€£æ¥ DALY BMSï¼Œæä¾›å³æ™‚ç›£æ§ã€æ™ºèƒ½è­¦å ±å’Œæ•¸æ“šåˆ†æåŠŸèƒ½ã€‚

## ğŸ“Š å°ˆæ¡ˆç‹€æ…‹

âœ… **æ ¸å¿ƒæ¶æ§‹å·²å®Œæˆ** - åš´æ ¼åˆ†å±¤æ¶æ§‹ã€ä¾è³´æ³¨å…¥ã€æœå‹™å±¤å¯¦ä½œå®Œæˆ  
âœ… **BMS é€šè¨Š** - DALY D2 Modbus å”è­°ç§»æ¤å®Œæˆï¼Œæ”¯æ´è—ç‰™ç›´é€£  
âœ… **æ•¸æ“šæŒä¹…åŒ–** - AsyncStorage + SQLite åˆ†å±¤å­˜å„²å¯¦ä½œå®Œæˆ  
âœ… **æœ¬åœ°é€šçŸ¥** - Notifee é›¢ç·šé€šçŸ¥ç³»çµ±å¯¦ä½œå®Œæˆ  
ğŸš§ **UI å±¤é–‹ç™¼ä¸­** - åŸºç¤çµ„ä»¶å’Œå„€è¡¨æ¿ç•Œé¢å¾…å®Œæˆ  

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### åš´æ ¼åˆ†å±¤æ¶æ§‹
```
src/
â”œâ”€â”€ services/           # æœå‹™å±¤ï¼ˆç´”é‚è¼¯ï¼‰
â”‚   â”œâ”€â”€ interfaces/     # æœå‹™ä»‹é¢å®šç¾©
â”‚   â”œâ”€â”€ implementations/ # å…·é«”å¯¦ä½œ
â”‚   â””â”€â”€ ServiceContainer.ts # ä¾è³´æ³¨å…¥å®¹å™¨
â”œâ”€â”€ domain/             # é ˜åŸŸå±¤
â”‚   â”œâ”€â”€ entities/       # å¯¦é«”æ¨¡å‹
â”‚   â””â”€â”€ usecases/       # ç”¨ä¾‹ï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
â”œâ”€â”€ presentation/       # å±•ç¤ºå±¤
â”‚   â”œâ”€â”€ viewmodels/     # MVVM æ¶æ§‹
â”‚   â”œâ”€â”€ screens/        # é é¢çµ„ä»¶
â”‚   â””â”€â”€ components/     # UI çµ„ä»¶
â””â”€â”€ utils/              # å·¥å…·å‡½æ•¸
```

### æ ¸å¿ƒæŠ€è¡“æ£§
- **æ¡†æ¶**: React Native + TypeScript
- **æ¶æ§‹æ¨¡å¼**: Clean Architecture + MVVM
- **ä¾è³´æ³¨å…¥**: TSyringe
- **è—ç‰™é€šè¨Š**: react-native-ble-plx
- **æœ¬åœ°é€šçŸ¥**: @notifee/react-native
- **æ•¸æ“šå­˜å„²**: 
  - **è¼•é‡é…ç½®**: AsyncStorage
  - **çµæ§‹åŒ–æ•¸æ“š**: SQLite
- **ç‹€æ…‹ç®¡ç†**: MobX

## ğŸ”§ å·²å¯¦ä½œåŠŸèƒ½

### 1. BLE è—ç‰™æœå‹™ (`BLEService`)
- âœ… å®Œæ•´çš„ DALY BMS D2 Modbus å”è­°å¯¦ä½œ
- âœ… è‡ªå‹•é‡é€£å’ŒéŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶
- âœ… è¨­å‚™æƒæå’Œé€£æ¥ç®¡ç†
- âœ… æ•¸æ“šè®€å–å’Œè§£æ
- âœ… é€£æ¥ç‹€æ…‹ç›£æ§

### 2. æœ¬åœ°é€šçŸ¥æœå‹™ (`NotificationService`) 
- âœ… Notifee é›†æˆï¼Œå®Œå…¨é›¢ç·šé‹ä½œ
- âœ… åˆ†ç´šé€šçŸ¥é€šé“ï¼ˆå±éšª/è­¦å‘Š/è³‡è¨Šï¼‰
- âœ… èƒŒæ™¯é€šçŸ¥è™•ç†
- âœ… é€šçŸ¥å‹•ä½œæ”¯æ´ï¼ˆç¢ºèª/ç¨å¾Œæé†’ï¼‰
- âœ… è·¨å¹³å°å…¼å®¹ï¼ˆiOS/Androidï¼‰

### 3. åˆ†å±¤æ•¸æ“šæŒä¹…åŒ– (`StorageService`)
- âœ… AsyncStorage å±¤ï¼šè¼•é‡é…ç½®å­˜å„²
- âœ… SQLite å±¤ï¼šçµæ§‹åŒ–æ•¸æ“šå­˜å„²
- âœ… é›»æ± æ•¸æ“šå’Œè­¦å ±è¨˜éŒ„ç®¡ç†
- âœ… æ•¸æ“šåŒ¯å‡ºå’Œæ¸…ç†åŠŸèƒ½
- âœ… çµ±è¨ˆè³‡è¨ŠæŸ¥è©¢

### 4. æ•¸æ“šè™•ç†æœå‹™ (`DataService`)
- âœ… æ•¸æ“šé©—è­‰å’Œè½‰æ›
- âœ… è­¦å ±è¦å‰‡å¼•æ“
- âœ… é›»æ± å¥åº·è©•ä¼°
- âœ… çµ±è¨ˆåˆ†æå’Œç•°å¸¸æª¢æ¸¬
- âœ… æ•¸æ“šå¹³æ»‘å’Œé æ¸¬

### 5. æ¥­å‹™ç”¨ä¾‹å±¤
- âœ… **é›»æ± ç›£æ§ç”¨ä¾‹** (`MonitorBatteryUseCase`)
  - ç›£æ§ç”Ÿå‘½é€±æœŸç®¡ç†
  - è‡ªå‹•é‡é€£æ©Ÿåˆ¶
  - æ•¸æ“šè®€å–å’Œå­˜å„²å”èª¿
  - çµ±è¨ˆå’Œå¥åº·è©•ä¼°

- âœ… **è­¦å ±è™•ç†ç”¨ä¾‹** (`HandleAlertsUseCase`)
  - å³æ™‚è­¦å ±æª¢æŸ¥
  - é€šçŸ¥ç™¼é€ç®¡ç†
  - è­¦å ±ç¢ºèªå’Œè§£æ±º
  - å†·å»æœŸæ§åˆ¶

### 6. ViewModel å±¤ (MVVM)
- âœ… **åŸºç¤ ViewModel** (`BaseViewModel`)
  - é€šç”¨ç‹€æ…‹ç®¡ç†
  - éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶
  - ç•°æ­¥æ“ä½œåŒ…è£å™¨

- âœ… **å„€è¡¨æ¿ ViewModel** (`DashboardViewModel`)
  - å³æ™‚æ•¸æ“šç¶å®š
  - è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶
  - è¨ˆç®—å±¬æ€§ï¼ˆå¥åº·ç‹€æ…‹ã€è­¦å ±ç­‰ç´šç­‰ï¼‰
  - å®Œæ•´çš„ç›£æ§æ§åˆ¶é‚è¼¯

## ğŸ“± æ ¸å¿ƒç‰¹æ€§

### ğŸ”µ å®Œå…¨é›¢ç·šé‹ä½œ
- **é›¶é›²ç«¯ä¾è³´**: æ‰€æœ‰åŠŸèƒ½æœ¬åœ°é‹è¡Œ
- **å³æ™‚éŸ¿æ‡‰**: ç„¡ç¶²è·¯å»¶é²
- **éš±ç§ä¿è­·**: æ•¸æ“šä¸é›¢é–‹è¨­å‚™
- **ç©©å®šå¯é **: ä¸å—ç¶²è·¯ç‹€æ³å½±éŸ¿

### ğŸ”µ å°ˆæ¥­ç´šæ¶æ§‹
- **ä¾è³´æ³¨å…¥**: 100% å¯æ¸¬è©¦çš„æœå‹™å±¤
- **åš´æ ¼åˆ†å±¤**: é‚è¼¯èˆ‡ UI å®Œå…¨è§£è€¦
- **MVVM æ¨¡å¼**: éŸ¿æ‡‰å¼æ•¸æ“šç¶å®š
- **éŒ¯èª¤è™•ç†**: å®Œæ•´çš„ç•°å¸¸æ¢å¾©æ©Ÿåˆ¶

### ğŸ”µ é€²éšåŠŸèƒ½
- **æ™ºèƒ½è­¦å ±**: å¤šç´šè­¦å ±è¦å‰‡å¼•æ“
- **å¥åº·è©•ä¼°**: é›»æ± ç‹€æ…‹åˆ†æ
- **æ•¸æ“šåˆ†æ**: è¶¨å‹¢é æ¸¬å’Œç•°å¸¸æª¢æ¸¬
- **èƒŒæ™¯ç›£æ§**: æ‡‰ç”¨åœ¨èƒŒæ™¯æ™‚æŒçºŒé‹ä½œ

## ğŸ”„ é–‹ç™¼é€²åº¦

### Phase 1: æ ¸å¿ƒæ¶æ§‹ âœ… (å·²å®Œæˆ)
- [x] React Native å°ˆæ¡ˆå»ºç«‹
- [x] ä¾è³´æ³¨å…¥æ¡†æ¶è¨­å®š
- [x] æœå‹™å±¤ä»‹é¢å®šç¾©
- [x] BMS å”è­°ç§»æ¤
- [x] åˆ†å±¤å­˜å„²å¯¦ä½œ

### Phase 2: æ¥­å‹™é‚è¼¯ âœ… (å·²å®Œæˆ)  
- [x] BLE é€šè¨Šæœå‹™å¯¦ä½œ
- [x] æœ¬åœ°é€šçŸ¥æœå‹™å¯¦ä½œ
- [x] æ•¸æ“šè™•ç†æœå‹™å¯¦ä½œ
- [x] Use Case å±¤å¯¦ä½œ
- [x] ViewModel å±¤å¯¦ä½œ

### Phase 3: UI é–‹ç™¼ ğŸš§ (é€²è¡Œä¸­)
- [ ] åŸºç¤ UI çµ„ä»¶å¯¦ä½œ
- [ ] ä¸»å„€è¡¨æ¿ç•«é¢
- [ ] è¨­å®šé é¢
- [ ] è­¦å ±ç®¡ç†ç•Œé¢
- [ ] æ­·å²æ•¸æ“šåœ–è¡¨

### Phase 4: æ¸¬è©¦èˆ‡å„ªåŒ– ğŸ“‹ (å¾…é–‹å§‹)
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹
- [ ] æ•´åˆæ¸¬è©¦
- [ ] UI/UX å„ªåŒ–
- [ ] æ•ˆèƒ½èª¿å„ª
- [ ] ç™¼å¸ƒæº–å‚™

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒè¦æ±‚
- Node.js >= 16
- React Native CLI
- Android Studio / Xcode
- æ”¯æ´ Bluetooth LE çš„è¨­å‚™

### å®‰è£ä¾è³´
```bash
cd bms-mobile-app
npm install

# iOS é¡å¤–æ­¥é©Ÿ
cd ios && pod install
```

### å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
```bash
# å•Ÿå‹• Metro bundler
npm start

# é‹è¡Œ Android ç‰ˆæœ¬
npm run android

# é‹è¡Œ iOS ç‰ˆæœ¬ (éœ€è¦ macOS)
npm run ios
```

## ğŸ“‹ é…ç½®èªªæ˜

### BMS è¨­å‚™é…ç½®
é è¨­é…ç½®æ”¯æ´ DALY BMS (8S LiFePO4)ï¼š
- MAC åœ°å€ï¼š`41:18:12:01:37:71`
- å”è­°ï¼šD2 Modbus RTU
- è®€å–é–“éš”ï¼š30 ç§’
- è‡ªå‹•é‡é€£ï¼šå•Ÿç”¨

### è­¦å ±è¦å‰‡
å…§å»ºè­¦å ±è¦å‰‡åŒ…æ‹¬ï¼š
- é›»å£“ç•°å¸¸ (< 24V æˆ– > 30.4V)
- æº«åº¦éé«˜ (> 45Â°C)
- é›»é‡ä¸è¶³ (< 20%)
- é€£æ¥ä¸­æ–·

## ğŸ§ª æ¸¬è©¦

### é‹è¡Œæ¸¬è©¦
```bash
# å–®å…ƒæ¸¬è©¦
npm test

# é¡å‹æª¢æŸ¥
npm run type-check

# ç¨‹å¼ç¢¼æª¢æŸ¥
npm run lint
```

### æœå‹™å±¤æ¸¬è©¦
æ‰€æœ‰æ ¸å¿ƒæœå‹™éƒ½è¨­è¨ˆç‚ºå¯å®Œå…¨æ¸¬è©¦ï¼š
- ä¾è³´æ³¨å…¥æ”¯æ´ Mock
- ä»‹é¢æŠ½è±¡åŒ–
- ç´”å‡½æ•¸è¨­è¨ˆ

## ğŸ“– æŠ€è¡“æ–‡æª”

### æœå‹™ä»‹é¢
- `IBLEService`: è—ç‰™é€šè¨Šä»‹é¢
- `INotificationService`: é€šçŸ¥æœå‹™ä»‹é¢  
- `IStorageService`: å­˜å„²æœå‹™ä»‹é¢
- `IDataService`: æ•¸æ“šè™•ç†ä»‹é¢

### æ ¸å¿ƒç”¨ä¾‹
- `MonitorBatteryUseCase`: é›»æ± ç›£æ§æ¥­å‹™é‚è¼¯
- `HandleAlertsUseCase`: è­¦å ±è™•ç†æ¥­å‹™é‚è¼¯

### ViewModel
- `BaseViewModel`: åŸºç¤ç‹€æ…‹ç®¡ç†
- `DashboardViewModel`: å„€è¡¨æ¿ç‹€æ…‹ç®¡ç†

## ğŸ¤ é–‹ç™¼æŒ‡å—

### æ–°å¢æœå‹™
1. åœ¨ `interfaces/` å®šç¾©ä»‹é¢
2. åœ¨ `implementations/` å¯¦ä½œæœå‹™
3. åœ¨ `ServiceRegistry.ts` è¨»å†Šæœå‹™
4. ç·¨å¯«å–®å…ƒæ¸¬è©¦

### æ–°å¢é é¢
1. å‰µå»º ViewModel ç¹¼æ‰¿ `BaseViewModel`
2. å¯¦ä½œé é¢çµ„ä»¶
3. åœ¨å°èˆªä¸­è¨»å†Šè·¯ç”±

### æœ€ä½³å¯¦å‹™
- éµå¾ª Clean Architecture åŸå‰‡
- ä½¿ç”¨ä¾è³´æ³¨å…¥é¿å…ç¡¬è€¦åˆ
- æ‰€æœ‰ç•°æ­¥æ“ä½œéƒ½è¦æœ‰éŒ¯èª¤è™•ç†
- UI çµ„ä»¶ä¿æŒç´”å±•ç¤ºåŠŸèƒ½

## ğŸ“„ æˆæ¬Š

MIT License - è©³è¦‹ [LICENSE](../LICENSE) æª”æ¡ˆ

## ğŸ™ è‡´è¬

æ„Ÿè¬åŸå§‹å°ˆæ¡ˆçš„é›»æ± é€šè¨Šå”è­°ç ”ç©¶æˆæœï¼Œç‚ºæœ¬æ‰‹æ©Ÿæ‡‰ç”¨çš„é–‹ç™¼æä¾›äº†å …å¯¦çš„æŠ€è¡“åŸºç¤ã€‚

---

**ğŸ“± ç›®æ¨™**: æ‰“é€ å°ˆæ¥­ã€ç©©å®šã€ç”¨æˆ¶å‹å¥½çš„ BMS æ‰‹æ©Ÿç›£æ§æ‡‰ç”¨  
**ğŸ¯ ç‰¹è‰²**: å®Œå…¨é›¢ç·šã€å³æ™‚éŸ¿æ‡‰ã€æ™ºèƒ½è­¦å ±ã€å°ˆæ¥­æ¶æ§‹  
**â­ ç¾æ³**: æ ¸å¿ƒæ¶æ§‹å®Œæˆï¼ŒUI é–‹ç™¼ä¸­ï¼Œé è¨ˆ 2 é€±å…§å®Œæˆ MVP**